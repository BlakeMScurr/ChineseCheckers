!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.game=class{constructor(e,t,r,o,n){this.startingPosition=r=>{!function(e){for(var t=0;t<e.length-1;t++)for(var r=t+1;r<e.length;r++){var o=e[t],n=e[r];if(o.name==n.name)throw"two players have name "+o.name;if(o.colour==n.colour)throw"two players have colour "+o.colour}}(r);var o=e.board();return t(o,r),o},this.validateMove=r,this.applyMove=o,this.winCondition=n}};t.player=class{constructor(e,t){this.name=e,this.colour=t}};t.graph=class{constructor(e){this.edges=new Map,e.forEach((e,t)=>{var r=t.string();null==this.edges.get(r)&&this.edges.set(r,new Map),e.forEach((e,t)=>{var o;null===(o=this.edges.get(r))||void 0===o||o.set(t.string(),e)})})}traverse(e,t){return t.forEach(t=>{var r=this.hop(e,t);null!=r&&(e=r)}),e}hop(e,t){var r=this.edges.get(e.string());if(null!=r)for(const[e,o]of r.entries())if(o.dir==t)return i(e)}board(){var e=new Map;for(const[r,o]of this.edges)e.set(i(r),t.emptyTile);return new o(e)}};t.direction=class{constructor(e){this.dir=e}};t.match=class{constructor(e,t,r){this.gameType=e,this.topology=t,this.players=r,this.moves=[],this.currentPlayer=0,this.boardState=e.startingPosition(r)}move(e){if(this.gameType.validateMove(this.currentPlayer,this.boardState,this.topology,e)){this.gameType.applyMove(this.currentPlayer,this.boardState,this.topology,e),this.currentPlayer=(this.currentPlayer+1)%this.players.length,this.moves.push(e);var t=this.gameType.winCondition(this.players,this.currentPlayer,this.boardState);return-1!=t?this.players[t]:void 0}}winner(){return this.gameType.winCondition(this.players,this.currentPlayer,this.boardState)}};class o{constructor(e){this.state=[],e.forEach((e,t)=>{null==this.state[t.x]&&this.set(e,t),this.state[t.x][t.y]=e})}forEach(e){this.state.forEach(t=>{t.forEach(t=>{e(t)})})}set(e,t){null==this.state[t.x]&&(this.state[t.x]=[]),this.state[t.x][t.y]=e}get(e){var r=this.state[e.x][e.y];return null==r?t.emptyTile:r}}t.board=o;class n{constructor(e,t){this.owner=e,this.type=t}}t.tile=n,t.emptyTile=new n(-1,"empty");function i(e){var t=JSON.parse(e);return new s(t.x,t.y)}t.move=class{constructor(e){this.coordinates=e}string(){return this.coordinates.map(e=>"("+e.x+","+e.y+")").join(", ")}};class s{constructor(e,t){this.x=e,this.y=t}equals(e){return this.string()==e.string()}string(){return JSON.stringify(this)}}t.coordinate=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r(2),n=r(0);var i=["white","violet"],s=["yellow","purple"];function a(e){document.querySelector("#title").innerHTML=-1==e.winner()?u[e.currentPlayer].name+"'s turn":u[e.winner()].name+" is the winner!!!"}function l(e){var t=Array.from(e.classList),r=-1,o=-1;if(t.forEach(e=>{e.match(/row*/)&&(r=+e.replace("row","")),e.match(/column*/)&&(o=+e.replace("column",""))}),-1==r||-1==o)throw"no row found: row: "+r+", column: "+o;return new n.coordinate(o,r)}function c(e,t){var r=document.getElementsByClassName("tile");for(let c of Array.from(r)){var o=c.childNodes[0],n=l(c);(n.x+n.y)%2==0?(c.style.backgroundColor="black",o.style.backgroundColor="black"):(c.style.backgroundColor="red",o.style.backgroundColor="red");var a=e.boardState.get(n);-1!=a.owner&&"empty"!=a.type&&(o.style.backgroundColor=i[a.owner],"queen"==a.type&&(o.style.backgroundColor=s[a.owner])),t.coordinates.forEach(e=>{n.x==e.x&&n.y==e.y&&(n.x+n.y)%2==0&&(c.style.backgroundColor="444",-1==a.owner&&(o.style.backgroundColor="444"))})}}var u=[new n.player("Blake",i[0]),new n.player("Anja",i[1])],h=o.newCheckersMatch(u),d=new class{constructor(){this.coordinates=[]}add(e){if((e.x+e.y)%2==0)if(0!=this.coordinates.length){var t=this.coordinates[this.coordinates.length-1];t.x==e.x&&t.y==e.y?this.coordinates.pop():this.coordinates.push(e)}else this.coordinates.push(e)}clear(){this.coordinates=[]}move(){return new n.move(this.coordinates)}};a(h),c(h,d);var y=document.getElementsByClassName("tile");for(let e of Array.from(y)){const t=l(e);e.onclick=(e=>()=>{d.add(e),c(h,d)})(t)}function f(){h.move(d.move()),d.clear(),c(h,d),a(h)}document.getElementById("move").onclick=()=>{f()},document.addEventListener("keydown",e=>{"Enter"==e.key&&f()})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r(0),n=r(3),i=new o.tile(0,"pawn"),s=new o.tile(1,"pawn"),a=new o.tile(0,"queen"),l=new o.tile(1,"queen");class c{topology(){return n.rightGrid(8,8)}initialiseState(e,t){for(var r=0;r<4;r++)e.set(i,new o.coordinate(2*r,0)),e.set(i,new o.coordinate(2*r+1,1)),e.set(i,new o.coordinate(2*r,2)),e.set(s,new o.coordinate(2*r+1,5)),e.set(s,new o.coordinate(2*r,6)),e.set(s,new o.coordinate(2*r+1,7))}validateMove(e,t,r,n){if(n.coordinates.length<2)throw"a move in checkers consists of at least two coordinates, the position of the piece to move, the position it moves to, and any positions it moves via";var i,s=t.get(n.coordinates[0]);if(e!=s.owner)return console.log("invalid move: first coordinate in a move should be the current player.\nCurrent player: "+e+", player owning selected piece: "+s.owner+"\nFor move "+n.string()+"\nSelected piece: "+JSON.stringify(s)),!1;(i=n,i.coordinates.slice(1,i.coordinates.length)).forEach(e=>{if(t.get(e)!=o.emptyTile)return console.log("invalid move: pieces must hop to and via empty tiles\nNon-empty tile: "+JSON.stringify(t.get(e))+" at "+JSON.stringify(e)),!1});var a=u(s);if(2==n.coordinates.length){var l=n.coordinates[0],c=n.coordinates[1],d=!1;if(a.forEach(e=>{r.traverse(l,[e,"left"]).equals(c)&&(d=!0),r.traverse(l,[e,"right"]).equals(c)&&(d=!0)}),d)return!0}var y=h(n,r,a);if(null==y)return console.log("invalid move: hops must be two steps in a valid direction"),!1;for(var f=0;f<y.length;f++){var v=t.get(y[f]).owner;if(v==e||-1==v)return!1}return!0}applyMove(e,t,r,n){var i=n.coordinates,s=i[i.length-1];t.set(t.get(i[0]),s),t.set(o.emptyTile,i[0]);var c=h(n,r,u(t.get(s)));null==c||c.forEach(e=>{t.set(o.emptyTile,e)}),7==s.y&&0==e&&t.set(a,s),0==s.y&&1==e&&t.set(l,s)}winCondition(e,t,r){var o=!1,n=!1;return r.forEach(e=>{0==e.owner&&(o=!0),1==e.owner&&(n=!0)}),o?n?-1:0:1}}function u(e){return"queen"==e.type?["up","down"]:0==e.owner?["up"]:["down"]}function h(e,t,r){var o=!0,n=[];if(function(e,t){for(var r=1;r<e.length;r++){var o=e[r-1],n=e[r];t(o,n)}}(e.coordinates,(e,i)=>{var s=!1;r.forEach(r=>{if(t.traverse(e,[r,r,"left","left"]).equals(i)){s=!0;var o=t.traverse(e,[r,"left"]);n.push(o)}if(t.traverse(e,[r,r,"right","right"]).equals(i)){s=!0;o=t.traverse(e,[r,"right"]);n.push(o)}}),s||(o=!1)}),o)return n}t.newCheckersMatch=function(e){var t=new c,r=t.topology();return new o.match(new o.game(r,t.initialiseState,t.validateMove,t.applyMove,t.winCondition),r,e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r(0);t.rightGrid=function(e,t){for(var r=new Map,n=Array(),i=0;i<e;i++)for(var s=0;s<t;s++)n.push(new o.coordinate(i,s));var a=new o.direction("down"),l=new o.direction("up"),c=new o.direction("left"),u=new o.direction("right");return n.forEach(e=>{r.set(e,new Map),n.forEach(t=>{var o,n,i,s;e.x==t.x&&(e.y==t.y+1?null===(o=r.get(e))||void 0===o||o.set(t,a):e.y==t.y-1&&(null===(n=r.get(e))||void 0===n||n.set(t,l))),e.y==t.y&&(e.x==t.x+1?null===(i=r.get(e))||void 0===i||i.set(t,c):e.x==t.x-1&&(null===(s=r.get(e))||void 0===s||s.set(t,u)))})}),new o.graph(r)}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvZ2FtZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWVzL2NoZWNrZXJzL2NoZWNrZXJzLnRzIiwid2VicGFjazovLy8uL3NyYy9ib2FyZHMvYm9hcmRzLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwidG9wb2xvZ3kiLCJpbml0aWFsaXNlU3RhdGUiLCJ2YWxpZGF0ZU1vdmUiLCJhcHBseU1vdmUiLCJ3aW5Db25kaXRpb24iLCJ0aGlzIiwic3RhcnRpbmdQb3NpdGlvbiIsInBsYXllcnMiLCJsZW5ndGgiLCJqIiwicSIsImNvbG91ciIsImNvbnNpc3RlbnRQbGF5ZXJzIiwiYiIsImJvYXJkIiwiZWRnZXMiLCJNYXAiLCJmb3JFYWNoIiwibTEiLCJjMSIsInMxIiwic3RyaW5nIiwidW5kZWZpbmVkIiwic2V0IiwiZGlyIiwiYzIiLCJkaXJlY2l0b25zIiwibmV4dEhvcCIsImhvcCIsImRpcmVjdGlvbiIsImFkamFjZW50cyIsImNzdHJpbmciLCJlbnRyaWVzIiwicGFyc2VDb29yZGluYXRlIiwiXyIsImVtcHR5VGlsZSIsImdhbWVUeXBlIiwibW92ZXMiLCJjdXJyZW50UGxheWVyIiwiYm9hcmRTdGF0ZSIsIm5leHRNb3ZlIiwicHVzaCIsIndpbm5pbmdQbGF5ZXIiLCJzdGF0ZSIsIngiLCJ5IiwiY2FsbGJhY2siLCJ0aWxlcyIsInRpbGUiLCJvd25lciIsInR5cGUiLCJKU09OIiwicGFyc2UiLCJjb29yZGluYXRlIiwiY29vcmRpbmF0ZXMiLCJtYXAiLCJqb2luIiwic3RyaW5naWZ5IiwicGxheWVyQ29sb3VyIiwicGxheWVySGlnaExpZ2h0Iiwic2V0VGl0bGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJ3aW5uZXIiLCJjb29yZGluYXRlRnJvbUVsZW1lbnQiLCJjbGFzc2VzIiwiQXJyYXkiLCJmcm9tIiwiY2xhc3NMaXN0Iiwicm93IiwiY29sdW1uIiwiY2xhc3NOYW1lIiwibWF0Y2giLCJyZXBsYWNlIiwicmVuZGVyQm9hcmQiLCJtaCIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJwaWVjZSIsImNoaWxkTm9kZXMiLCJzdHlsZSIsImJhY2tncm91bmRDb2xvciIsImdhbWVUaWxlIiwibW92ZUMiLCJwbGF5ZXIiLCJtYXRjaEluc3RhbmNlIiwibmV3Q2hlY2tlcnNNYXRjaCIsImxhc3QiLCJwb3AiLCJtb3ZlIiwib25jbGljayIsImFkZCIsIm1ha2VDbGlja2VyIiwibWFrZU1vdmUiLCJjbGVhciIsImdldEVsZW1lbnRCeUlkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2IiwicGF3bjAiLCJwYXduMSIsInF1ZWVuMCIsInF1ZWVuMSIsIkNoZWNrZXJzIiwicmlnaHRHcmlkIiwiZW1wdHlTdGF0ZSIsImNvbnNvbGUiLCJsb2ciLCJzbGljZSIsImRpcnMiLCJkaXJlY3Rpb25zIiwic3RhcnQiLCJlbmQiLCJob3BWYWxpZCIsInRyYXZlcnNlIiwiZXF1YWxzIiwiaCIsImhvcHBlZCIsImNzIiwiZGVzdCIsInAwQWxpdmUiLCJwMUFsaXZlIiwibW92ZVZhbGlkIiwiaG9wcyIsImZyb2ciLCJnIiwiZ2FtZSIsImFsbFRpbGVzIiwiZG93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QU10RixHQUFLdUYsRUFBTXZGLElBQ2JzRixFQUFNdkYsR0FBS3dGLEVBQU14RixFQUFJLEVBRUwsUUFBaEIsRUFBQTdCLEVBQU1sQyxJQUFJc0osVUFBTSxTQUFFNUcsSUFBSTZHLEVBQU9ILEdBQ3RCRSxFQUFNdkYsR0FBS3dGLEVBQU14RixFQUFJLElBRVosUUFBaEIsRUFBQTdCLEVBQU1sQyxJQUFJc0osVUFBTSxTQUFFNUcsSUFBSTZHLEVBQU9GLFNBTXRDLElBQUksRUFBQUcsTUFBTXRIIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsIi8vIEhlcmVpbiBsaWVzIHRoZSBsb2dpYyBmb3IgZGVzY3JpYmluZyBhIHBlcmZlY3QgaW5mb3JtYXRpb24gYm9hcmQgZ2FtZSBhdCBhbiBhYnN0cmFjdCBsZXZlbFxuXG5leHBvcnQgY2xhc3MgZ2FtZSB7XG4gICAgc3RhcnRpbmdQb3NpdGlvbjogKHBsYXllcnM6IEFycmF5PHBsYXllcj4pID0+IGJvYXJkXG4gICAgdmFsaWRhdGVNb3ZlOiAoY3VycmVudFBsYXllcjogbnVtYmVyLCBib2FyZFN0YXRlOiBib2FyZCwgdG9wb2xvZ3k6IGdyYXBoLCBuZXh0TW92ZTogbW92ZSkgPT4gYm9vbGVhblxuICAgIGFwcGx5TW92ZTogKGN1cnJlbnRQbGF5ZXI6IG51bWJlciwgYm9hcmRTdGF0ZTogYm9hcmQsIHRvcG9sb2d5OiBncmFwaCwgbmV4dE1vdmU6IG1vdmUpID0+IHZvaWRcbiAgICB3aW5Db25kaXRpb246IChwbGF5ZXJzOiBBcnJheTxwbGF5ZXI+LCBjdXJyZW50UGxheWVyOiBudW1iZXIsIGJvYXJkU3RhdGU6IGJvYXJkKSA9PiBudW1iZXJcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICAgICAgdG9wb2xvZ3k6IGdyYXBoLCBcbiAgICAgICAgICAgIGluaXRpYWxpc2VTdGF0ZTogKGVtcHR5U3RhdGU6IGJvYXJkLCBwbGF5ZXJzOiBBcnJheTxwbGF5ZXI+KSA9PiB2b2lkLFxuICAgICAgICAgICAgdmFsaWRhdGVNb3ZlOiAoY3VycmVudFBsYXllcjogbnVtYmVyLCBib2FyZFN0YXRlOiBib2FyZCwgdG9wb2xvZ3k6IGdyYXBoLCBuZXh0TW92ZTogbW92ZSkgPT4gYm9vbGVhbixcbiAgICAgICAgICAgIGFwcGx5TW92ZTogKGN1cnJlbnRQbGF5ZXI6IG51bWJlciwgYm9hcmRTdGF0ZTogYm9hcmQsIHRvcG9sb2d5OiBncmFwaCwgbmV4dE1vdmU6IG1vdmUpID0+IHZvaWQsXG4gICAgICAgICAgICB3aW5Db25kaXRpb246IChwbGF5ZXJzOiBBcnJheTxwbGF5ZXI+LCBjdXJyZW50UGxheWVyOiBudW1iZXIsIGJvYXJkU3RhdGU6IGJvYXJkKSA9PiBudW1iZXJcbiAgICAgICAgKXtcbiAgICAgICAgdGhpcy5zdGFydGluZ1Bvc2l0aW9uID0gKHBsYXllcnM6IEFycmF5PHBsYXllcj4pID0+IHtcbiAgICAgICAgICAgIGNvbnNpc3RlbnRQbGF5ZXJzKHBsYXllcnMpXG4gICAgICAgICAgICB2YXIgYiA9IHRvcG9sb2d5LmJvYXJkKClcbiAgICAgICAgICAgIGluaXRpYWxpc2VTdGF0ZShiLCBwbGF5ZXJzKVxuICAgICAgICAgICAgcmV0dXJuIGJcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZhbGlkYXRlTW92ZSA9IHZhbGlkYXRlTW92ZVxuICAgICAgICB0aGlzLmFwcGx5TW92ZSA9IGFwcGx5TW92ZVxuICAgICAgICB0aGlzLndpbkNvbmRpdGlvbiA9IHdpbkNvbmRpdGlvblxuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIHBsYXllciB7XG4gICAgbmFtZTogc3RyaW5nXG4gICAgY29sb3VyOiBzdHJpbmdcblxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgY29sb3VyOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZVxuICAgICAgICB0aGlzLmNvbG91ciA9IGNvbG91clxuICAgIH1cbn1cblxuLy8gVGhpcyBncmFwaCByZXByZXNlbnRzIHRoZSByZWxhdGlvbnNoaXBzIGJldHdlZW4gdGlsZXMgb24gdGhlIGJvYXJkXG4vLyBUT0RPOiB1c2UgZ3JhcGggZGVwZW5kZW5jeSAvLyB2YXIgZ3JhcGggPSByZXF1aXJlKFwiZ3JhcGgtZGF0YS1zdHJ1Y3R1cmVcIilcbmV4cG9ydCBjbGFzcyBncmFwaCB7XG4gICAgLy8gVGhpcyBpcyBhIHR3byBieSB0d28gbWF0cml4IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBncmFwaFxuICAgIGVkZ2VzOiBNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCBkaXJlY3Rpb24+PlxuXG4gICAgY29uc3RydWN0b3IoZWRnZXM6IE1hcDxjb29yZGluYXRlLCBNYXA8Y29vcmRpbmF0ZSwgZGlyZWN0aW9uPj4pIHtcbiAgICAgICAgdGhpcy5lZGdlcyA9IG5ldyBNYXAoKVxuICAgICAgICBlZGdlcy5mb3JFYWNoKChtMTogTWFwPGNvb3JkaW5hdGUsIGRpcmVjdGlvbj4sIGMxOiBjb29yZGluYXRlKSA9PiB7XG4gICAgICAgICAgICB2YXIgczEgPSBjMS5zdHJpbmcoKVxuXG4gICAgICAgICAgICBpZiAodGhpcy5lZGdlcy5nZXQoczEpID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZWRnZXMuc2V0KHMxLCBuZXcgTWFwPHN0cmluZywgZGlyZWN0aW9uPigpKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtMS5mb3JFYWNoKChkaXI6IGRpcmVjdGlvbiwgYzI6IGNvb3JkaW5hdGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVkZ2VzLmdldChzMSk/LnNldChjMi5zdHJpbmcoKSwgZGlyKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdHJhdmVyc2UoYzogY29vcmRpbmF0ZSwgZGlyZWNpdG9uczogQXJyYXk8c3RyaW5nPikge1xuICAgICAgICBkaXJlY2l0b25zLmZvckVhY2goKGRpcjogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICB2YXIgbmV4dEhvcCA9IHRoaXMuaG9wKGMsIGRpcilcbiAgICAgICAgICAgIGlmIChuZXh0SG9wID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYyA9IG5leHRIb3BcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIGNcbiAgICB9XG5cbiAgICBob3AoYzogY29vcmRpbmF0ZSwgZGlyZWN0aW9uOiBzdHJpbmcpIHtcbiAgICAgICAgdmFyIGFkamFjZW50cyA9IHRoaXMuZWRnZXMuZ2V0KGMuc3RyaW5nKCkpXG4gICAgICAgIGlmIChhZGphY2VudHMgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IFtjc3RyaW5nLCBkaXJdIG9mIGFkamFjZW50cy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGlmIChkaXIuZGlyID09IGRpcmVjdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUNvb3JkaW5hdGUoY3N0cmluZylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGJvYXJkKCk6Ym9hcmQge1xuICAgICAgICB2YXIgYjogTWFwPGNvb3JkaW5hdGUsIHRpbGU+ID0gbmV3IE1hcCgpXG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IFtjc3RyaW5nLCBfXSBvZiB0aGlzLmVkZ2VzKSB7XG4gICAgICAgICAgICBiLnNldChwYXJzZUNvb3JkaW5hdGUoY3N0cmluZyksIGVtcHR5VGlsZSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IGJvYXJkKGIpXG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgZGlyZWN0aW9uIHtcbiAgICBkaXI6IHN0cmluZ1xuXG4gICAgY29uc3RydWN0b3IoZGlyOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5kaXIgPSBkaXJcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBtYXRjaCB7XG4gICAgLy8gQ29uc3RhbnQgZGVmaW5pdGlvblxuICAgIGdhbWVUeXBlOiBnYW1lXG4gICAgdG9wb2xvZ3k6IGdyYXBoXG4gICAgcGxheWVyczogQXJyYXk8cGxheWVyPlxuXG4gICAgLy8gQ2hhbmdpbmcgc3RhdGVcbiAgICBtb3ZlczogQXJyYXk8bW92ZT5cbiAgICBjdXJyZW50UGxheWVyOiBudW1iZXJcbiAgICBib2FyZFN0YXRlOiBib2FyZFxuXG4gICAgY29uc3RydWN0b3IoZ2FtZVR5cGU6IGdhbWUsIHRvcG9sb2d5OiBncmFwaCwgcGxheWVyczogQXJyYXk8cGxheWVyPikge1xuICAgICAgICB0aGlzLmdhbWVUeXBlID0gZ2FtZVR5cGVcbiAgICAgICAgdGhpcy50b3BvbG9neSA9IHRvcG9sb2d5XG4gICAgICAgIHRoaXMucGxheWVycyA9IHBsYXllcnNcbiAgICAgICAgdGhpcy5tb3ZlcyA9IFtdXG4gICAgICAgIHRoaXMuY3VycmVudFBsYXllciA9IDBcbiAgICAgICAgdGhpcy5ib2FyZFN0YXRlID0gZ2FtZVR5cGUuc3RhcnRpbmdQb3NpdGlvbihwbGF5ZXJzKVxuICAgIH1cblxuICAgIG1vdmUobmV4dE1vdmU6IG1vdmUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmdhbWVUeXBlLnZhbGlkYXRlTW92ZSh0aGlzLmN1cnJlbnRQbGF5ZXIsIHRoaXMuYm9hcmRTdGF0ZSwgdGhpcy50b3BvbG9neSwgbmV4dE1vdmUpKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ2FtZVR5cGUuYXBwbHlNb3ZlKHRoaXMuY3VycmVudFBsYXllciwgdGhpcy5ib2FyZFN0YXRlLCB0aGlzLnRvcG9sb2d5LCBuZXh0TW92ZSlcbiAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyID0gKHRoaXMuY3VycmVudFBsYXllciArIDEpICUgdGhpcy5wbGF5ZXJzLmxlbmd0aFxuICAgICAgICB0aGlzLm1vdmVzLnB1c2gobmV4dE1vdmUpXG5cbiAgICAgICAgdmFyIHdpbm5pbmdQbGF5ZXIgPSB0aGlzLmdhbWVUeXBlLndpbkNvbmRpdGlvbih0aGlzLnBsYXllcnMsIHRoaXMuY3VycmVudFBsYXllciwgdGhpcy5ib2FyZFN0YXRlKVxuICAgICAgICBpZiAod2lubmluZ1BsYXllciAhPSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyc1t3aW5uaW5nUGxheWVyXVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgd2lubmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nYW1lVHlwZS53aW5Db25kaXRpb24odGhpcy5wbGF5ZXJzLCB0aGlzLmN1cnJlbnRQbGF5ZXIsIHRoaXMuYm9hcmRTdGF0ZSlcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBib2FyZCB7XG4gICAgc3RhdGU6IEFycmF5PEFycmF5PHRpbGU+PlxuXG4gICAgY29uc3RydWN0b3Ioc3RhdGU6IE1hcDxjb29yZGluYXRlLCB0aWxlPikge1xuICAgICAgICB0aGlzLnN0YXRlID0gW11cbiAgICAgICAgc3RhdGUuZm9yRWFjaCgodDogdGlsZSwgYzogY29vcmRpbmF0ZSk9PntcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlW2MueF0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXQodCwgYylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc3RhdGVbYy54XVtjLnldID0gdFxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGZvckVhY2goY2FsbGJhY2s6ICh0OiB0aWxlKT0+dm9pZCkge1xuICAgICAgICB0aGlzLnN0YXRlLmZvckVhY2goKHRpbGVzOiB0aWxlW10pID0+IHtcbiAgICAgICAgICAgIHRpbGVzLmZvckVhY2goKHQ6IHRpbGUpID0+IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh0KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBzZXQodDogdGlsZSwgYzogY29vcmRpbmF0ZSkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZVtjLnhdID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZVtjLnhdID0gW11cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXRlW2MueF1bYy55XSA9IHRcbiAgICB9XG5cbiAgICBnZXQoYzogY29vcmRpbmF0ZSkge1xuICAgICAgICB2YXIgdCA9IHRoaXMuc3RhdGVbYy54XVtjLnldXG4gICAgICAgIGlmICh0ID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGVtcHR5VGlsZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgdGlsZSB7XG4gICAgLy8gcGxheWVyIG51bWJlciBvZiBvd25lclxuICAgIG93bmVyOiBudW1iZXJcbiAgICB0eXBlOiBzdHJpbmdcblxuICAgIGNvbnN0cnVjdG9yKG93bmVyOiBudW1iZXIsIHR5cGU6IHN0cmluZykge1xuICAgICAgICB0aGlzLm93bmVyID0gb3duZXJcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGVtcHR5VGlsZSA9IG5ldyB0aWxlKC0xLCBcImVtcHR5XCIpXG5cbmV4cG9ydCBjbGFzcyBtb3ZlIHtcbiAgICBjb29yZGluYXRlczogQXJyYXk8Y29vcmRpbmF0ZT5cblxuICAgIGNvbnN0cnVjdG9yKGNvb3JkaW5hdGVzOiBBcnJheTxjb29yZGluYXRlPikge1xuICAgICAgICB0aGlzLmNvb3JkaW5hdGVzID0gY29vcmRpbmF0ZXNcbiAgICB9XG5cbiAgICBzdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvb3JkaW5hdGVzLm1hcCgoYzogY29vcmRpbmF0ZSk9PntyZXR1cm4gXCIoXCIgKyBjLnggKyBcIixcIiArIGMueSArIFwiKVwifSkuam9pbihcIiwgXCIpXG4gICAgfVxufVxuXG5mdW5jdGlvbiBwYXJzZUNvb3JkaW5hdGUoczogc3RyaW5nKTpjb29yZGluYXRlIHtcbiAgICB2YXIgYyA9IDxjb29yZGluYXRlPkpTT04ucGFyc2UocylcbiAgICByZXR1cm4gbmV3IGNvb3JkaW5hdGUoYy54LCBjLnkpXG59XG5cbmV4cG9ydCBjbGFzcyBjb29yZGluYXRlIHtcbiAgICB4OiBudW1iZXJcbiAgICB5OiBudW1iZXJcblxuICAgIGNvbnN0cnVjdG9yKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMueCA9IHhcbiAgICAgICAgdGhpcy55ID0geVxuICAgIH1cblxuICAgIGVxdWFscyhjOiBjb29yZGluYXRlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0cmluZygpID09IGMuc3RyaW5nKClcbiAgICB9XG5cbiAgICBzdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzKVxuICAgIH1cbn1cblxuLy8gVXRpbGl0eSBmdW5jdGlvbnNcbi8vIFRPRE86IG1vdmUgdG8gc2VwYXJhdGUgZmlsZXNcblxuLy8gQ2hlY2sgY29uc2lzdGVuY3kgb2YgcGxheWVyc1xuZnVuY3Rpb24gY29uc2lzdGVudFBsYXllcnMocGxheWVyczogQXJyYXk8cGxheWVyPikge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVycy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IGkrMTsgaiA8IHBsYXllcnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHZhciBwID0gcGxheWVyc1tpXVxuICAgICAgICAgICAgdmFyIHEgPSBwbGF5ZXJzW2pdXG4gICAgICAgICAgICBpZiAocC5uYW1lID09IHEubmFtZSkge1xuICAgICAgICAgICAgICAgIHRocm93IFwidHdvIHBsYXllcnMgaGF2ZSBuYW1lIFwiICsgcC5uYW1lXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocC5jb2xvdXIgPT0gcS5jb2xvdXIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBcInR3byBwbGF5ZXJzIGhhdmUgY29sb3VyIFwiICsgcC5jb2xvdXJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0iLCJpbXBvcnQge25ld0NoZWNrZXJzTWF0Y2h9IGZyb20gJy4vZ2FtZXMvY2hlY2tlcnMvY2hlY2tlcnMnXG5pbXBvcnQge3BsYXllciwgdGlsZSwgbWF0Y2gsIGNvb3JkaW5hdGUsIG1vdmV9IGZyb20gJy4vZ2FtZS9nYW1lJ1xuXG4vLyBEZWZpbmUgcmVuZGVyaW5nXG5cbnZhciB0aWxlQ29sb3VyMSA9IFwiYmxhY2tcIlxudmFyIHRpbGVDb2xvdXIyID0gXCJyZWRcIlxudmFyIHBsYXllckNvbG91ciA9IFtcIndoaXRlXCIsIFwidmlvbGV0XCJdXG52YXIgcGxheWVySGlnaExpZ2h0ID0gW1wieWVsbG93XCIsIFwicHVycGxlXCJdXG52YXIgc2VsZWN0ZWRIaWdobGlnaHQgPSBcIjQ0NFwiXG5cbmZ1bmN0aW9uIHNldFRpdGxlKG06IG1hdGNoKSB7XG4gICAgdmFyIHRpdGxlID0gPEhUTUxIZWFkaW5nRWxlbWVudD5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RpdGxlXCIpXG4gICAgdGl0bGUuaW5uZXJIVE1MID0gbS53aW5uZXIoKSA9PSAtMT8gcGxheWVyc1ttLmN1cnJlbnRQbGF5ZXJdLm5hbWUgKyBcIidzIHR1cm5cIjogcGxheWVyc1ttLndpbm5lcigpXS5uYW1lICsgXCIgaXMgdGhlIHdpbm5lciEhIVwiXG59XG5cbmZ1bmN0aW9uIGNvb3JkaW5hdGVGcm9tRWxlbWVudCh0aWxlOiBIVE1MRGl2RWxlbWVudCkge1xuICAgIHZhciBjbGFzc2VzID0gQXJyYXkuZnJvbSh0aWxlLmNsYXNzTGlzdClcbiAgICB2YXIgcm93ID0gLTFcbiAgICB2YXIgY29sdW1uID0gLTFcbiAgICBjbGFzc2VzLmZvckVhY2goKGNsYXNzTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIGlmIChjbGFzc05hbWUubWF0Y2goL3JvdyovKSkge1xuICAgICAgICAgICAgcm93ID0gK2NsYXNzTmFtZS5yZXBsYWNlKFwicm93XCIsICcnKVxuICAgICAgICB9XG4gICAgICAgIGlmIChjbGFzc05hbWUubWF0Y2goL2NvbHVtbiovKSkge1xuICAgICAgICAgICAgY29sdW1uID0gK2NsYXNzTmFtZS5yZXBsYWNlKFwiY29sdW1uXCIsICcnKVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGlmIChyb3cgPT0gLTEgfHwgY29sdW1uID09IC0xKSB7XG4gICAgICAgIHRocm93IFwibm8gcm93IGZvdW5kOiByb3c6IFwiICsgcm93ICsgXCIsIGNvbHVtbjogXCIgKyBjb2x1bW5cbiAgICB9XG4gICAgcmV0dXJuIG5ldyBjb29yZGluYXRlKGNvbHVtbiwgcm93KVxufVxuXG5mdW5jdGlvbiByZW5kZXJCb2FyZChtOiBtYXRjaCwgbWg6IG1vdmVIYW5kbGVyKSB7XG4gICAgdmFyIHRpbGVzID0gPEhUTUxDb2xsZWN0aW9uT2Y8SFRNTERpdkVsZW1lbnQ+PmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJ0aWxlXCIpXG4gICAgZm9yIChsZXQgdGlsZSBvZiBBcnJheS5mcm9tKHRpbGVzKSkgeyAgICAgICAgXG4gICAgICAgIHZhciBwaWVjZSA9IDxIVE1MRGl2RWxlbWVudD50aWxlLmNoaWxkTm9kZXNbMF1cbiAgICAgICAgdmFyIGMgPSBjb29yZGluYXRlRnJvbUVsZW1lbnQodGlsZSlcblxuICAgICAgICBpZiAoKGMueCArIGMueSkgJSAyID09IDApIHtcbiAgICAgICAgICAgIHRpbGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gdGlsZUNvbG91cjFcbiAgICAgICAgICAgIHBpZWNlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHRpbGVDb2xvdXIxXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aWxlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHRpbGVDb2xvdXIyXG4gICAgICAgICAgICBwaWVjZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB0aWxlQ29sb3VyMlxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGdhbWVUaWxlID0gbS5ib2FyZFN0YXRlLmdldChjKVxuICAgICAgICBpZiAoZ2FtZVRpbGUub3duZXIgIT0gLTEgJiYgZ2FtZVRpbGUudHlwZSAhPSBcImVtcHR5XCIpIHtcbiAgICAgICAgICAgIHBpZWNlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHBsYXllckNvbG91cltnYW1lVGlsZS5vd25lcl1cbiAgICAgICAgICAgIGlmIChnYW1lVGlsZS50eXBlID09IFwicXVlZW5cIikge1xuICAgICAgICAgICAgICAgIHBpZWNlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHBsYXllckhpZ2hMaWdodFtnYW1lVGlsZS5vd25lcl1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIFxuICAgICAgICBtaC5jb29yZGluYXRlcy5mb3JFYWNoKChtb3ZlQzogY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGMueCA9PSBtb3ZlQy54ICYmIGMueSA9PSBtb3ZlQy55ICYmIChjLnggKyBjLnkpICUgMiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGlsZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBzZWxlY3RlZEhpZ2hsaWdodFxuICAgICAgICAgICAgICAgIGlmIChnYW1lVGlsZS5vd25lciA9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBwaWVjZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBzZWxlY3RlZEhpZ2hsaWdodFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG59XG5cbi8vIGhhbmRsZSBnYW1lIHN0YXRlIGlucHV0XG5jbGFzcyBtb3ZlSGFuZGxlciB7XG4gICAgY29vcmRpbmF0ZXM6IEFycmF5PGNvb3JkaW5hdGU+XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY29vcmRpbmF0ZXMgPSBbXVxuICAgIH1cblxuICAgIGFkZChjOiBjb29yZGluYXRlKSB7XG4gICAgICAgIGlmICgoYy54ICsgYy55KSAlIDIgIT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jb29yZGluYXRlcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5jb29yZGluYXRlcy5wdXNoKGMpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsYXN0ID0gdGhpcy5jb29yZGluYXRlc1t0aGlzLmNvb3JkaW5hdGVzLmxlbmd0aC0xXVxuICAgICAgICBpZiAobGFzdC54ID09IGMueCAmJiBsYXN0LnkgPT0gYy55KSB7XG4gICAgICAgICAgICB0aGlzLmNvb3JkaW5hdGVzLnBvcCgpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvb3JkaW5hdGVzLnB1c2goYylcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLmNvb3JkaW5hdGVzID0gW11cbiAgICB9XG5cbiAgICBtb3ZlKCkge1xuICAgICAgICByZXR1cm4gbmV3IG1vdmUodGhpcy5jb29yZGluYXRlcylcbiAgICB9XG59XG5cbi8vIENyZWF0ZSBhbmQgcmVuZGVyIGluaXRpYWwgc3RhdGVzXG52YXIgcGxheWVycyA9IFtuZXcgcGxheWVyKFwiQmxha2VcIiwgcGxheWVyQ29sb3VyWzBdKSwgbmV3IHBsYXllcihcIkFuamFcIiwgcGxheWVyQ29sb3VyWzFdKV1cbnZhciBtYXRjaEluc3RhbmNlID0gbmV3Q2hlY2tlcnNNYXRjaChwbGF5ZXJzKVxudmFyIG1oID0gbmV3IG1vdmVIYW5kbGVyKClcblxuc2V0VGl0bGUobWF0Y2hJbnN0YW5jZSlcbnJlbmRlckJvYXJkKG1hdGNoSW5zdGFuY2UsIG1oKVxuXG4vLyBBZGQgaW50ZXJhY3Rpdml0eVxudmFyIHRpbGVzID0gPEhUTUxDb2xsZWN0aW9uT2Y8SFRNTERpdkVsZW1lbnQ+PmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJ0aWxlXCIpXG5mb3IgKGxldCB0aWxlIG9mIEFycmF5LmZyb20odGlsZXMpKSB7XG4gICAgY29uc3QgYyA9IGNvb3JkaW5hdGVGcm9tRWxlbWVudCh0aWxlKVxuICAgIHZhciBtYWtlQ2xpY2tlciA9IChjOiBjb29yZGluYXRlKSA9PiB7XG4gICAgICAgIHJldHVybiAoKSA9PiB7IFxuICAgICAgICAgICAgbWguYWRkKGMpXG4gICAgICAgICAgICByZW5kZXJCb2FyZChtYXRjaEluc3RhbmNlLCBtaClcbiAgICAgICAgfVxuICAgIH1cbiAgICB0aWxlLm9uY2xpY2sgPSBtYWtlQ2xpY2tlcihjKVxufVxuXG52YXIgbW92ZUJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vdmVcIilcbmZ1bmN0aW9uIG1ha2VNb3ZlKCl7XG4gICAgbWF0Y2hJbnN0YW5jZS5tb3ZlKG1oLm1vdmUoKSlcbiAgICBtaC5jbGVhcigpXG4gICAgcmVuZGVyQm9hcmQobWF0Y2hJbnN0YW5jZSwgbWgpXG4gICAgc2V0VGl0bGUobWF0Y2hJbnN0YW5jZSlcbn1cblxubW92ZUJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgIG1ha2VNb3ZlKClcbn1cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXY6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICBpZiAoZXYua2V5ID09IFwiRW50ZXJcIikge1xuICAgICAgICBtYWtlTW92ZSgpXG4gICAgfVxufSkiLCJpbXBvcnQgeyBnYW1lLCBtYXRjaCwgZ3JhcGgsIHBsYXllciwgYm9hcmQsIG1vdmUsIGNvb3JkaW5hdGUsIHRpbGUsIGVtcHR5VGlsZSB9IGZyb20gXCIuLi8uLi9nYW1lL2dhbWVcIlxuaW1wb3J0IHsgcmlnaHRHcmlkIH0gZnJvbSBcIi4uLy4uL2JvYXJkcy9ib2FyZHNcIlxuXG5jb25zdCBwYXduMCA9IG5ldyB0aWxlKDAsIFwicGF3blwiKVxuY29uc3QgcGF3bjEgPSBuZXcgdGlsZSgxLCBcInBhd25cIilcbmNvbnN0IHF1ZWVuMCA9IG5ldyB0aWxlKDAsIFwicXVlZW5cIilcbmNvbnN0IHF1ZWVuMSA9IG5ldyB0aWxlKDEsIFwicXVlZW5cIilcblxuY2xhc3MgQ2hlY2tlcnMge1xuICAgIHRvcG9sb2d5KCk6Z3JhcGgge1xuICAgICAgICByZXR1cm4gcmlnaHRHcmlkKDgsIDgpXG4gICAgfVxuXG4gICAgaW5pdGlhbGlzZVN0YXRlKGVtcHR5U3RhdGU6IGJvYXJkLCBwbGF5ZXJzOiBBcnJheTxwbGF5ZXI+KSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7XG4gICAgICAgICAgICBlbXB0eVN0YXRlLnNldChwYXduMCwgbmV3IGNvb3JkaW5hdGUoaSoyLCAwKSlcbiAgICAgICAgICAgIGVtcHR5U3RhdGUuc2V0KHBhd24wLCBuZXcgY29vcmRpbmF0ZShpKjIrMSwgMSkpXG4gICAgICAgICAgICBlbXB0eVN0YXRlLnNldChwYXduMCwgbmV3IGNvb3JkaW5hdGUoaSoyLCAyKSlcblxuICAgICAgICAgICAgZW1wdHlTdGF0ZS5zZXQocGF3bjEsIG5ldyBjb29yZGluYXRlKGkqMisxLCA1KSlcbiAgICAgICAgICAgIGVtcHR5U3RhdGUuc2V0KHBhd24xLCBuZXcgY29vcmRpbmF0ZShpKjIsIDYpKVxuICAgICAgICAgICAgZW1wdHlTdGF0ZS5zZXQocGF3bjEsIG5ldyBjb29yZGluYXRlKGkqMisxLCA3KSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhbGlkYXRlTW92ZShjdXJyZW50UGxheWVyOiBudW1iZXIsIGJvYXJkU3RhdGU6IGJvYXJkLCB0b3BvbG9neTogZ3JhcGgsIG5leHRNb3ZlOiBtb3ZlKTpib29sZWFuIHtcbiAgICAgICAgaWYgKG5leHRNb3ZlLmNvb3JkaW5hdGVzLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgIHRocm93IFwiYSBtb3ZlIGluIGNoZWNrZXJzIGNvbnNpc3RzIG9mIGF0IGxlYXN0IHR3byBjb29yZGluYXRlcywgdGhlIHBvc2l0aW9uIG9mIHRoZSBwaWVjZSB0byBtb3ZlLCB0aGUgcG9zaXRpb24gaXQgbW92ZXMgdG8sIGFuZCBhbnkgcG9zaXRpb25zIGl0IG1vdmVzIHZpYVwiXG4gICAgICAgIH1cblxuICAgICAgICBcbiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIHBpZWNlIGlzIG9mIHRoZSByaWdodCBwbGF5ZXJcbiAgICAgICAgdmFyIHBpZWNlID0gYm9hcmRTdGF0ZS5nZXQobmV4dE1vdmUuY29vcmRpbmF0ZXNbMF0pXG4gICAgICAgIGlmIChjdXJyZW50UGxheWVyICE9IHBpZWNlLm93bmVyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImludmFsaWQgbW92ZTogZmlyc3QgY29vcmRpbmF0ZSBpbiBhIG1vdmUgc2hvdWxkIGJlIHRoZSBjdXJyZW50IHBsYXllci5cXG5DdXJyZW50IHBsYXllcjogXCIgKyBjdXJyZW50UGxheWVyICsgXCIsIHBsYXllciBvd25pbmcgc2VsZWN0ZWQgcGllY2U6IFwiICsgcGllY2Uub3duZXIgKyBcIlxcbkZvciBtb3ZlIFwiICsgbmV4dE1vdmUuc3RyaW5nKCkgKyBcIlxcblNlbGVjdGVkIHBpZWNlOiBcIiArIEpTT04uc3RyaW5naWZ5KHBpZWNlKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIHBpZWNlIGlzIG1vdmluZyB0byBhbmQgdmlhIGVtcHR5IHNwYWNlc1xuICAgICAgICBkZXN0aW5hdGlvbnNJbihuZXh0TW92ZSkuZm9yRWFjaCgoYzogY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGJvYXJkU3RhdGUuZ2V0KGMpICE9IGVtcHR5VGlsZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiaW52YWxpZCBtb3ZlOiBwaWVjZXMgbXVzdCBob3AgdG8gYW5kIHZpYSBlbXB0eSB0aWxlc1xcbk5vbi1lbXB0eSB0aWxlOiBcIiArIEpTT04uc3RyaW5naWZ5KGJvYXJkU3RhdGUuZ2V0KGMpKSArIFwiIGF0IFwiICsgSlNPTi5zdHJpbmdpZnkoYykpIFxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIHZhciBkaXJzID0gZGlyZWN0aW9ucyhwaWVjZSlcbiAgICAgICAgXG4gICAgICAgIC8vIGlmIHdlIGFyZSBvbmx5IG1vdmluZyBvbmUgc3F1YXJlLCBlbnN1cmUgaXQncyBpbiBhIHZhbGlkIGRpcmVjdGlvblxuICAgICAgICBpZiAobmV4dE1vdmUuY29vcmRpbmF0ZXMubGVuZ3RoID09IDIpIHtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IG5leHRNb3ZlLmNvb3JkaW5hdGVzWzBdXG4gICAgICAgICAgICB2YXIgZW5kID0gbmV4dE1vdmUuY29vcmRpbmF0ZXNbMV1cblxuICAgICAgICAgICAgdmFyIGhvcFZhbGlkID0gZmFsc2VcbiAgICAgICAgICAgIGRpcnMuZm9yRWFjaCgoZGlyOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodG9wb2xvZ3kudHJhdmVyc2Uoc3RhcnQsIFtkaXIsIFwibGVmdFwiXSkuZXF1YWxzKGVuZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaG9wVmFsaWQgPSB0cnVlXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRvcG9sb2d5LnRyYXZlcnNlKHN0YXJ0LCBbZGlyLCBcInJpZ2h0XCJdKS5lcXVhbHMoZW5kKSkge1xuICAgICAgICAgICAgICAgICAgICBob3BWYWxpZCA9IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgaWYgKGhvcFZhbGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IGFsbCBwYXRocyBiZXR3ZWVuIGFkamFjZW50IHBvc2l0aW9ucyBhcmUgdHdvIHN0ZXBzIGluIGEgdmFsaWQgZGlyZWN0aW9uXG4gICAgICAgIHZhciBoID0gaG9wcGVkKG5leHRNb3ZlLCB0b3BvbG9neSwgZGlycylcbiAgICAgICAgaWYgKGggPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImludmFsaWQgbW92ZTogaG9wcyBtdXN0IGJlIHR3byBzdGVwcyBpbiBhIHZhbGlkIGRpcmVjdGlvblwiKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cblxuICAgICAgICAvLyBlbnN1cmUgdGhhdCBhbGwgaG9wcGVkIHBvc2l0aW9ucyBoYXZlIGFuIG9wcG9zaW5nIHBsYXllclxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgaC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIG93bmVyID0gYm9hcmRTdGF0ZS5nZXQoaFtpXSkub3duZXJcbiAgICAgICAgICAgIGlmIChvd25lciA9PSBjdXJyZW50UGxheWVyIHx8IG93bmVyID09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIGFwcGx5TW92ZShjdXJyZW50UGxheWVyOiBudW1iZXIsIGJvYXJkU3RhdGU6IGJvYXJkLCB0b3BvbG9neTogZ3JhcGgsIG5leHRNb3ZlOiBtb3ZlKSB7XG4gICAgICAgIHZhciBjcyA9IG5leHRNb3ZlLmNvb3JkaW5hdGVzXG4gICAgICAgIHZhciBkZXN0ID0gY3NbY3MubGVuZ3RoLTFdXG5cbiAgICAgICAgLy8gTW92ZSBwaWVjZSBmcm9tIHN0YXJ0IHRvIGRlc3RpbmF0aW9uXG4gICAgICAgIGJvYXJkU3RhdGUuc2V0KGJvYXJkU3RhdGUuZ2V0KGNzWzBdKSwgZGVzdClcbiAgICAgICAgYm9hcmRTdGF0ZS5zZXQoZW1wdHlUaWxlLCBjc1swXSlcblxuICAgICAgICAvLyBSZW1vdmUgaG9wcGVkIHBpZWNlc1xuICAgICAgICB2YXIgaCA9IGhvcHBlZChuZXh0TW92ZSwgdG9wb2xvZ3ksIGRpcmVjdGlvbnMoYm9hcmRTdGF0ZS5nZXQoZGVzdCkpKVxuICAgICAgICBoPy5mb3JFYWNoKChjOiBjb29yZGluYXRlKT0+e1xuICAgICAgICAgICAgYm9hcmRTdGF0ZS5zZXQoZW1wdHlUaWxlLCBjKVxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIFByb21vdGUgcGllY2VcbiAgICAgICAgaWYgKGRlc3QueSA9PSA3ICYmIGN1cnJlbnRQbGF5ZXIgPT0gMCkge1xuICAgICAgICAgICAgYm9hcmRTdGF0ZS5zZXQocXVlZW4wLCBkZXN0KVxuICAgICAgICB9XG4gICAgICAgIGlmIChkZXN0LnkgPT0gMCAmJiBjdXJyZW50UGxheWVyID09IDEpIHtcbiAgICAgICAgICAgIGJvYXJkU3RhdGUuc2V0KHF1ZWVuMSwgZGVzdClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHdpbkNvbmRpdGlvbihwbGF5ZXJzOiBBcnJheTxwbGF5ZXI+LCBjdXJyZW50UGxheWVyOiBudW1iZXIsIGJvYXJkU3RhdGU6IGJvYXJkKTpudW1iZXIge1xuICAgICAgICB2YXIgcDBBbGl2ZSA9IGZhbHNlXG4gICAgICAgIHZhciBwMUFsaXZlID0gZmFsc2VcbiAgICAgICAgYm9hcmRTdGF0ZS5mb3JFYWNoKCh0OiB0aWxlKSA9PiB7XG4gICAgICAgICAgICBpZiAodC5vd25lciA9PSAwKSB7XG4gICAgICAgICAgICAgICAgcDBBbGl2ZSA9IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0Lm93bmVyID09IDEpIHtcbiAgICAgICAgICAgICAgICBwMUFsaXZlID0gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFwMEFsaXZlKSB7XG4gICAgICAgICAgICByZXR1cm4gMVxuICAgICAgICB9IGlmICghcDFBbGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIDBcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gLTFcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBuZXdDaGVja2Vyc01hdGNoKHBsYXllcnM6IEFycmF5PHBsYXllcj4pOm1hdGNoIHtcbiAgICB2YXIgYyA9IG5ldyBDaGVja2Vyc1xuICAgIHZhciBnID0gYy50b3BvbG9neSgpXG5cbiAgICByZXR1cm4gbmV3IG1hdGNoKFxuICAgICAgICBuZXcgZ2FtZSAoXG4gICAgICAgICAgICBnLFxuICAgICAgICAgICAgYy5pbml0aWFsaXNlU3RhdGUsXG4gICAgICAgICAgICBjLnZhbGlkYXRlTW92ZSxcbiAgICAgICAgICAgIGMuYXBwbHlNb3ZlLFxuICAgICAgICAgICAgYy53aW5Db25kaXRpb24sXG4gICAgICAgICksXG4gICAgICAgIGcsXG4gICAgICAgIHBsYXllcnMsXG4gICAgKVxufVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9uc1xuXG4vLyBUaGUgZmlyc3QgY29vcmRpbmF0ZSBpbiBhIG1vdmUgaXMgdGhlIHN0YXJ0aW5nIHBvaW50LCB0aGUgcmVzdCBhcmUgZGVzdGluYXRpb25zXG5mdW5jdGlvbiBkZXN0aW5hdGlvbnNJbihtOiBtb3ZlKSB7XG4gICAgcmV0dXJuIG0uY29vcmRpbmF0ZXMuc2xpY2UoMSwgbS5jb29yZGluYXRlcy5sZW5ndGgpXG59XG5cbi8vIGRldGVybWluZSB0aGUgdmFsaWQgc2V0IG9mIGRpcmVjdGlvbnMgYXZhaWxhYmxlIHRvIHRoZSBwaWVjZVxuZnVuY3Rpb24gZGlyZWN0aW9ucyhwaWVjZTogdGlsZSkge1xuICAgIHZhciBkaXJzOiBBcnJheTxzdHJpbmc+ID0gW11cbiAgICBpZiAocGllY2UudHlwZSA9PSBcInF1ZWVuXCIpIHtcbiAgICAgICAgZGlycyA9IFtcInVwXCIsIFwiZG93blwiXVxuICAgIH0gZWxzZSBpZiAocGllY2Uub3duZXIgPT0gMCkge1xuICAgICAgICBkaXJzID0gW1widXBcIl1cbiAgICB9IGVsc2Uge1xuICAgICAgICBkaXJzID0gW1wiZG93blwiXVxuICAgIH1cbiAgICByZXR1cm4gZGlyc1xufVxuXG5mdW5jdGlvbiBob3BwZWQobmV4dE1vdmU6IG1vdmUsIHRvcG9sb2d5OiBncmFwaCwgZGlyZWN0aW9uczogQXJyYXk8c3RyaW5nPik6Y29vcmRpbmF0ZVtdfHVuZGVmaW5lZCB7XG4gICAgdmFyIG1vdmVWYWxpZCA9IHRydWVcbiAgICB2YXIgaG9wcGVkOiBBcnJheTxjb29yZGluYXRlPiA9IFtdXG4gICAgaG9wcyhuZXh0TW92ZS5jb29yZGluYXRlcywgKHN0YXJ0OiBjb29yZGluYXRlLCBlbmQ6IGNvb3JkaW5hdGUpID0+IHtcbiAgICAgICAgdmFyIGhvcFZhbGlkID0gZmFsc2VcbiAgICAgICAgZGlyZWN0aW9ucy5mb3JFYWNoKChkaXI6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgaWYgKHRvcG9sb2d5LnRyYXZlcnNlKHN0YXJ0LCBbZGlyLCBkaXIsIFwibGVmdFwiLCBcImxlZnRcIl0pLmVxdWFscyhlbmQpKSB7XG4gICAgICAgICAgICAgICAgaG9wVmFsaWQgPSB0cnVlXG4gICAgICAgICAgICAgICAgLy8gYSBsZWFwZWQgZnJvZ1xuICAgICAgICAgICAgICAgIHZhciBmcm9nID0gdG9wb2xvZ3kudHJhdmVyc2Uoc3RhcnQsIFtkaXIsIFwibGVmdFwiXSlcbiAgICAgICAgICAgICAgICBob3BwZWQucHVzaChmcm9nKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodG9wb2xvZ3kudHJhdmVyc2Uoc3RhcnQsIFtkaXIsIGRpciwgXCJyaWdodFwiLCBcInJpZ2h0XCJdKS5lcXVhbHMoZW5kKSkge1xuICAgICAgICAgICAgICAgIGhvcFZhbGlkID0gdHJ1ZVxuICAgICAgICAgICAgICAgIHZhciBmcm9nID0gdG9wb2xvZ3kudHJhdmVyc2Uoc3RhcnQsIFtkaXIsIFwicmlnaHRcIl0pXG4gICAgICAgICAgICAgICAgaG9wcGVkLnB1c2goZnJvZylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIWhvcFZhbGlkKSB7XG4gICAgICAgICAgICBtb3ZlVmFsaWQgPSBmYWxzZVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIGlmIChtb3ZlVmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIGhvcHBlZFxuICAgIH1cbn1cblxuZnVuY3Rpb24gaG9wcyhjb29yZGluYXRlczogQXJyYXk8Y29vcmRpbmF0ZT4sIGNhbGxiYWNrOiAoc3RhcnQ6IGNvb3JkaW5hdGUsIGVuZDogY29vcmRpbmF0ZSkgPT4gdm9pZCkge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgY29vcmRpbmF0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gY29vcmRpbmF0ZXNbaS0xXVxuICAgICAgICB2YXIgZW5kID0gY29vcmRpbmF0ZXNbaV1cbiAgICAgICAgY2FsbGJhY2soc3RhcnQsIGVuZClcbiAgICB9XG59IiwiaW1wb3J0IHsgZ3JhcGgsIGNvb3JkaW5hdGUsIGRpcmVjdGlvbiB9IGZyb20gXCIuLi9nYW1lL2dhbWVcIlxuXG4vLyBDcmVhdGVzIHRoZSBhZGphY2VuY3kgZ3JhcGggZm9yIGEgcmlnaHQgYW5nbGVkIGdyaWQgb2Ygd2lkdGggeCBhbmQgaGVpZ2h0IHlcbmV4cG9ydCBmdW5jdGlvbiByaWdodEdyaWQoeDogbnVtYmVyLCB5OiBudW1iZXIpOmdyYXBoIHtcbiAgICB2YXIgZWRnZXMgPSBuZXcgTWFwPGNvb3JkaW5hdGUsIE1hcDxjb29yZGluYXRlLCBkaXJlY3Rpb24+PigpXG5cbiAgICB2YXIgYWxsVGlsZXMgPSBBcnJheTxjb29yZGluYXRlPigpXG4gICAgZm9yKHZhciBpID0gMDsgaSA8IHg7IGkrKykge1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8eTsgaisrKSB7XG4gICAgICAgICAgICBhbGxUaWxlcy5wdXNoKG5ldyBjb29yZGluYXRlKGksIGopKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGRvd24gPSBuZXcgZGlyZWN0aW9uKFwiZG93blwiKVxuICAgIHZhciB1cCA9IG5ldyBkaXJlY3Rpb24oXCJ1cFwiKVxuICAgIHZhciBsZWZ0ID0gbmV3IGRpcmVjdGlvbihcImxlZnRcIilcbiAgICB2YXIgcmlnaHQgPSBuZXcgZGlyZWN0aW9uKFwicmlnaHRcIilcblxuICAgIC8vIG5eMiBhbGdvcml0aG0gdW5saWtlbHkgdG8gYmUgYSBib3R0bGUgbmVjaywgYXMgdGhpcyBpcyBvbmx5IHJ1biBvbmNlIHBlciBtYXRjaCwgYW5kIHggYW5kIHkgYXJlIGxpa2VseSB0byBiZSBzbWFsbFxuICAgIGFsbFRpbGVzLmZvckVhY2goKHRpbGUxOiBjb29yZGluYXRlKSA9PiB7XG4gICAgICAgIGVkZ2VzLnNldCh0aWxlMSwgbmV3IE1hcCgpKVxuICAgICAgICBhbGxUaWxlcy5mb3JFYWNoKCh0aWxlMjogY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRpbGUxLnggPT0gdGlsZTIueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aWxlMS55ID09IHRpbGUyLnkgKyAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkZ2VzLmdldCh0aWxlMSk/LnNldCh0aWxlMiwgZG93bilcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRpbGUxLnkgPT0gdGlsZTIueSAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgZWRnZXMuZ2V0KHRpbGUxKT8uc2V0KHRpbGUyLCB1cClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aWxlMS55ID09IHRpbGUyLnkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGlsZTEueCA9PSB0aWxlMi54ICsgMSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aWxlMSkgKyBcIiB0aGVuIGxlZnQgZ2l2ZXMgXCIgKyBKU09OLnN0cmluZ2lmeSh0aWxlMikpXG4gICAgICAgICAgICAgICAgICAgIGVkZ2VzLmdldCh0aWxlMSk/LnNldCh0aWxlMiwgbGVmdClcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRpbGUxLnggPT0gdGlsZTIueCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGlsZTEpICsgXCIgdGhlbiByaWdodCBnaXZlcyBcIiArIEpTT04uc3RyaW5naWZ5KHRpbGUyKSlcbiAgICAgICAgICAgICAgICAgICAgZWRnZXMuZ2V0KHRpbGUxKT8uc2V0KHRpbGUyLCByaWdodClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSlcblxuICAgIHJldHVybiBuZXcgZ3JhcGgoZWRnZXMpXG59Il0sInNvdXJjZVJvb3QiOiIifQ==